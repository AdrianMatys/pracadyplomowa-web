import{d as D,r as n,e as I,a as b,g as w,b as e,i as o,t as r,q as N,m as h,s as k,v as T,w as P,p as m,x as M,y as q,f as g,u as O,z as U,o as l}from"./vendor-lIf_UB2E.js";import{a as A}from"./MainHeader.vue_vue_type_script_setup_true_lang-Brchc_ys.js";import{a as F,u as K,b as $}from"./main-I4fwh5Br.js";import{u as G}from"./useDashboardData-BJuXQkcW.js";import{u as H}from"./useRecaptcha-C-7uMv4J.js";import{I as S}from"./IconSpinner-COqzgk4U.js";import{I as J,a as Q}from"./IconEyeOff-B2F4WV-7.js";import"./axios-B9ygI19o.js";const X={class:"flex min-h-screen flex-col bg-bgPrimary text-textWhite"},Y={class:"flex flex-1 items-center justify-center px-6 py-10"},Z={class:"w-full max-w-md space-y-8 rounded-2xl border border-strokePrimary/30 bg-card p-8 shadow-2xl shadow-black/20"},ee={class:"text-center"},te={class:"text-3xl font-bold text-textWhite"},se={class:"mt-2 text-sm text-textSecondary"},oe={class:"space-y-4"},ae={class:"space-y-2"},re={for:"email",class:"text-sm font-semibold text-textWhite"},ie=["placeholder"],ne={class:"space-y-2"},le={class:"flex items-center justify-between"},ce={for:"password",class:"text-sm font-semibold text-textWhite"},de={class:"relative"},ue=["type","placeholder"],pe={key:0,class:"rounded-lg bg-green-500/10 p-3 text-sm text-green-400"},me={key:1,class:"rounded-lg bg-red-500/10 p-3 text-sm text-red-400 space-y-2"},fe=["disabled"],ye=["disabled"],xe={class:"text-center text-sm text-textSecondary"},Le=D({__name:"LoginPage",setup(ve){const L=O(),j=U(),{login:W}=F(),{dashboardData:z}=G(),{t}=K(),{getToken:B,loadScript:E}=H(),c=n(""),d=n(""),f=n(!1),u=n(!1),a=n(""),y=n(!1),p=n(!1),_=n(!1),R=z.value?.navLinks??[];I(()=>{E()});const V=async()=>{if(!c.value||!d.value){a.value=t("login.errorEmptyFields");return}u.value=!0,a.value="",y.value=!1,_.value=!1;try{const i=await B("login");await W({email:c.value,password:d.value,recaptcha_token:i});const s=j.query.redirect||"/";L.push(s)}catch(i){if(i.response?.status===403&&i.response.data?.email_unverified)y.value=!0,a.value="Twój adres email nie został potwierdzony. Sprawdź skrzynkę pocztową lub wyślij link ponownie.";else if(i.response?.status===422){const s=i.response.data.errors;if(s){const x=Object.keys(s)[0];a.value=s[x][0]}else a.value=i.response.data.message||t("login.errorEmptyFields")}else i.code==="ERR_NETWORK"?a.value=t("common.connectionError")||"Błąd połączenia z serwerem":a.value=t("common.error")||"Wystąpił błąd logowania"}finally{u.value=!1}},C=async()=>{p.value=!0;try{await $.post("/api/auth/resend-verification",{email:c.value,password:d.value}),_.value=!0,a.value="",y.value=!1}catch{a.value="Nie udało się wysłać emaila. Spróbuj ponownie."}finally{p.value=!1}};return(i,s)=>{const x=M("RouterLink");return l(),b("div",X,[w(A,{"nav-links":o(R)},null,8,["nav-links"]),e("main",Y,[e("div",Z,[e("div",ee,[e("h1",te,r(o(t)("login.title")),1),e("p",se,r(o(t)("login.subtitle")),1)]),e("form",{class:"space-y-6",onSubmit:N(V,["prevent"])},[e("div",oe,[e("div",ae,[e("label",re,r(o(t)("login.emailLabel")),1),k(e("input",{id:"email","onUpdate:modelValue":s[0]||(s[0]=v=>c.value=v),type:"email",required:"",class:"w-full rounded-xl border border-strokePrimary/40 bg-inputBg px-4 py-3 text-sm text-textWhite placeholder:text-textSecondary focus:border-textPrimary focus:outline-none focus:ring-1 focus:ring-textPrimary",placeholder:o(t)("login.emailPlaceholder")},null,8,ie),[[T,c.value]])]),e("div",ne,[e("div",le,[e("label",ce,r(o(t)("login.passwordLabel")),1),w(x,{to:{name:"forgot-password"},class:"text-xs text-textPrimary hover:underline"},{default:P(()=>[m(r(o(t)("login.forgotPassword")),1)]),_:1})]),e("div",de,[k(e("input",{id:"password","onUpdate:modelValue":s[1]||(s[1]=v=>d.value=v),type:f.value?"text":"password",required:"",class:"w-full rounded-xl border border-strokePrimary/40 bg-inputBg px-4 py-3 pr-12 text-sm text-textWhite placeholder:text-textSecondary focus:border-textPrimary focus:outline-none focus:ring-1 focus:ring-textPrimary",placeholder:o(t)("login.passwordPlaceholder")},null,8,ue),[[q,d.value]]),e("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-textSecondary hover:text-textWhite focus:outline-none",onClick:s[2]||(s[2]=v=>f.value=!f.value)},[f.value?(l(),g(J,{key:0,class:"h-5 w-5"})):(l(),g(Q,{key:1,class:"h-5 w-5"}))])])])]),_.value?(l(),b("div",pe," ✓ Link weryfikacyjny został wysłany. Sprawdź swoją skrzynkę pocztową. ")):a.value?(l(),b("div",me,[e("p",null,r(a.value),1),y.value?(l(),b("button",{key:0,type:"button",class:"mt-1 flex items-center gap-2 text-xs font-semibold text-amber-400 hover:text-amber-300 transition-colors",disabled:p.value,onClick:C},[p.value?(l(),g(S,{key:0,class:"h-3 w-3 animate-spin"})):h("",!0),m(" "+r(p.value?"Wysyłanie...":"Wyślij link weryfikacyjny ponownie →"),1)],8,fe)):h("",!0)])):h("",!0),e("button",{type:"submit",class:"flex w-full items-center justify-center gap-2 rounded-full bg-textPrimary px-6 py-3 text-sm font-semibold text-bgPrimary transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary disabled:cursor-not-allowed disabled:opacity-70",disabled:u.value},[u.value?(l(),g(S,{key:0,class:"h-5 w-5 animate-spin text-bgPrimary"})):h("",!0),m(" "+r(u.value?o(t)("login.submitting"):o(t)("login.submitButton")),1)],8,ye)],32),e("div",xe,[m(r(o(t)("login.noAccount"))+" ",1),w(x,{to:{name:"register"},class:"font-semibold text-textPrimary hover:underline"},{default:P(()=>[m(r(o(t)("login.registerLink")),1)]),_:1})])])])])}}});export{Le as default};
