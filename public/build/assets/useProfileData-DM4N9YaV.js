import{u as x,a as d,b as f}from"./main-I4fwh5Br.js";import{a as w,c as C,b as I}from"./useDashboardData-BJuXQkcW.js";import{B as A}from"./vendor-lIf_UB2E.js";let u=null;function b(){const{currentLanguage:c}=x(),{refreshUser:l}=d(),{data:e,isLoading:p,error:v,load:m,refresh:g}=w(async()=>{const{isLoggedIn:s}=d();return s.value?I(c.value):null}),L=(s=!1)=>m(s),t=()=>g(),h=async(s,a,o,r)=>{if(!e.value)return;const n=e.value.courseProgress.find(i=>i.courseId===s);n&&(n.completedLessonIds.includes(a)||n.completedLessonIds.push(a),r&&(n.savedCode={...n.savedCode,[a]:r}));try{await C(s,a,r),await t(),await l()}catch(i){console.error("Failed to save progress",i)}},y=async(s,a)=>{if(e.value){const o=e.value.courseProgress.find(r=>r.courseId===s);o?o.status="enrolled":(e.value.courseProgress.push({courseId:s,completedLessonIds:[],savedCode:{},status:"enrolled"}),e.value.summary.inProgress++,a&&e.value.enrolledCourses.push({id:s,title:a.title,level:a.level||"Junior",image_path:a.image_path,progress:0,completedLessons:0,totalLessons:a.totalLessons||0,accent:"blue",status:"enrolled",updatedAt:new Date().toISOString(),nextLesson:void 0}))}try{await f.post(`/api/courses/${s}/enroll`)}finally{t(),l()}},P=async s=>{if(e.value){const a=e.value.courseProgress.findIndex(r=>r.courseId===s);a!==-1&&(e.value.courseProgress.splice(a,1),e.value.summary.inProgress=Math.max(0,e.value.summary.inProgress-1));const o=e.value.enrolledCourses.findIndex(r=>r.id===s);o!==-1&&e.value.enrolledCourses.splice(o,1)}try{await f.delete(`/api/courses/${s}/enroll`)}finally{t(),l()}};return A(c,()=>{e.value&&t()}),{profileData:e,isProfileLoading:p,profileError:v,loadProfileData:L,refreshProfileData:t,markLessonAsCompleted:h,enrollInCourse:y,leaveCourse:P}}const $=()=>(u||(u=b()),u);export{$ as u};
