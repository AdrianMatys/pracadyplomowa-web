import{a as r,o as l,b as e,d as de,c as d,z as ue,r as h,e as xe,B as P,m as H,g as f,i as a,p as g,t as s,F as m,h as J,A as fe,q as L,C as me,u as ve,n as K,D as be}from"./vendor-lIf_UB2E.js";import{a as pe}from"./MainHeader.vue_vue_type_script_setup_true_lang-BKi87J7A.js";import{u as he,f as ge}from"./useDashboardData-BnW-B8ai.js";import{u as ye}from"./useProfileData-6GzBRG_F.js";import{_ as _e,u as ke,a as we,I as O,d as Ce,e as Pe,c as Le}from"./main-CyjH2vMn.js";import{I as De}from"./IconLock-Brps_nWm.js";import{I as Se}from"./IconArrowLeft-BmIU9R-Q.js";import"./axios-B9ygI19o.js";const je={},Ie={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"};function Te(E,y){return l(),r("svg",Ie,[...y[0]||(y[0]=[e("path",{d:"M5 12h14","stroke-linecap":"round"},null,-1),e("path",{d:"M12 5v14","stroke-linecap":"round"},null,-1)])])}const Be=_e(je,[["render",Te]]),ze={class:"flex min-h-screen flex-col bg-bgPrimary text-textWhite"},Me={class:"mx-auto flex w-full max-w-6xl flex-1 flex-col gap-8 px-6 py-10"},We=["aria-label"],Ne={key:0,class:"space-y-8 rounded-2xl border border-strokePrimary/30 bg-card p-6 shadow-2xl shadow-black/20"},Ae={class:"space-y-4"},$e={class:"text-xs uppercase tracking-[0.3em] text-textSecondary"},Re={class:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between"},Ve={class:"space-y-3"},Fe={class:"flex items-center gap-4"},He={key:0,class:"flex h-16 w-16 items-center justify-center rounded-2xl bg-cardDarker p-3 shadow-lg"},Je=["src","alt"],Ke={class:"text-3xl font-bold text-textWhite"},Oe={class:"text-sm leading-relaxed text-textSecondary lg:max-w-2xl"},Ee={class:"flex flex-wrap gap-2"},qe={class:"w-full max-w-sm space-y-4 rounded-2xl border border-strokePrimary/30 bg-cardDarker p-5"},Ge={class:"flex items-center justify-between"},Ue={class:"flex flex-col text-sm text-textSecondary"},Qe={class:"text-lg text-textWhite"},Xe={class:"flex flex-col text-sm text-textSecondary"},Ye={class:"text-lg text-textWhite"},Ze={class:"flex flex-col text-sm text-textSecondary"},et={class:"text-lg text-textWhite"},tt={class:"mb-2 flex items-center justify-between text-xs text-textSecondary"},st={class:"h-2 w-full overflow-hidden rounded-full bg-cardHover"},ot={key:0,class:"space-y-3"},at=["aria-label"],rt={class:"rounded-2xl border border-emerald-400/30 bg-[#102421] px-4 py-3 text-sm text-emerald-200"},lt=["aria-label"],it={class:"rounded-2xl border border-textPrimary/20 bg-card px-4 py-3 text-sm text-textSecondary"},nt=["aria-label"],ct={key:1,class:"rounded-2xl border border-textPrimary/20 bg-card px-4 py-3 text-sm text-textSecondary text-center"},dt={class:"space-y-4"},ut={class:"flex items-center justify-between"},xt={class:"text-xl font-semibold text-textWhite"},ft={class:"space-y-4"},mt=["onClick"],vt={class:"flex items-center justify-between gap-4"},bt={class:"space-y-1"},pt={class:"text-sm font-semibold text-textWhite"},ht={class:"text-textSecondary mr-1"},gt={class:"flex items-center gap-3"},yt=["aria-label"],_t=["aria-label"],kt={key:1,class:"flex flex-col items-center justify-center gap-6 rounded-2xl border border-strokePrimary/30 bg-card p-12 text-center"},wt={class:"text-2xl font-bold"},Ct={class:"text-sm text-textSecondary"},Pt={class:"text-2xl font-bold"},Lt={class:"text-sm text-textSecondary"},Dt=["aria-label"],St=["onKeydown"],jt={class:"flex items-center gap-3"},It={class:"flex h-10 w-10 items-center justify-center rounded-full bg-[#3a1a24] text-[#ffb4c8]"},Tt={id:"leave-course-title",class:"text-lg font-semibold text-textWhite"},Bt={id:"leave-course-description",class:"text-sm text-textSecondary"},zt={class:"flex flex-col gap-3 sm:flex-row"},Mt=["aria-label"],Wt=["aria-label"],Kt=de({__name:"CoursePage",setup(E){const y=ue(),D=ve(),{dashboardData:S,isDashboardLoading:q,loadDashboardData:G}=he(),{profileData:j,loadProfileData:U,enrollInCourse:Q,leaveCourse:X}=ye(),{t,currentLanguage:I}=ke(),{user:Y}=we(),{notify:Z}=Le(),v=d(()=>y.params.courseId),T=h(null),B=h(!1),z=async()=>{B.value=!0;try{const o=await ge(v.value,I.value);o&&(T.value=o)}catch(o){console.error("Error loading course details:",o)}finally{B.value=!1}};xe(()=>{G(),U(),z()}),P(I,()=>{z()});const ee=d(()=>S.value?.navLinks??[]),te=d(()=>S.value?.courses??[]),M=d(()=>j.value?.courseProgress.find(o=>o.courseId===v.value)),n=d(()=>T.value||te.value.find(o=>o.id===v.value)),k=d(()=>n.value?.title==="Darmowy kurs dla gości"||n.value?.title==="Free guest course"),x=d(()=>{const o=n.value?.lessons??[];if(k.value)return o.map(i=>({...i,isCompleted:!1,isLocked:!1}));const c=M.value;return c?o.map((i,p)=>{const V=i.id.toString(),F=c.completedLessonIds.includes(V),ce=p===0||F||p>0&&c.completedLessonIds.includes(o[p-1].id.toString());return{...i,isCompleted:F,isLocked:!ce}}):o.map(i=>({...i,isCompleted:!1,isLocked:!0}))}),W=d(()=>x.value.length===0?0:x.value.filter(o=>o.isCompleted).length),w=d(()=>x.value.length===0?0:Math.round(W.value/x.value.length*100)),se=d(()=>({completed:t("lessonStatus.completed"),locked:t("lessonStatus.locked"),available:t("lessonStatus.available"),"in-progress":t("lessonStatus.inProgress")})),oe={completed:"bg-[#1f8a70]/30 text-[#60f5d2]",locked:"bg-[#3a1d32] text-[#ffb4c8]",available:"bg-[#1e2b3f] text-[#7fd1ff]","in-progress":"bg-[#312440] text-[#e5c1ff]"},u=h(!1),b=h(!1),N=h(null),C=d(()=>!u.value||x.value.length===0?!1:w.value===100);P([M,k],([o,c])=>{c?u.value=!0:u.value=!!o},{immediate:!0});const A=o=>{switch(o?.toLowerCase()){case"junior":return 1;case"mid":return 2;case"senior":return 3;default:return 1}},ae=d(()=>{const o=n.value?.level?.toLowerCase()??"junior",c=(j.value?.summary?.level||Y.value?.level||"junior").toLowerCase();return A(o)>A(c)}),re=async()=>{if(!u.value){if(ae.value){Z("error","Masz niewystarczający poziom konta, aby zapisać się na ten kurs");return}try{await Q(v.value,{title:n.value?.title||"",image_path:n.value?.image_path,level:n.value?.level,totalLessons:x.value.length})}catch{}}},le=()=>{!u.value||C.value||(b.value=!0)},_=()=>{b.value&&(b.value=!1)},ie=async()=>{if(!u.value||C.value){_();return}try{await X(v.value)}catch{}finally{b.value=!1}},$=()=>{D.push({name:"main"})},R=o=>o.isLocked?"locked":o.isCompleted?"completed":u.value?"in-progress":"available",ne=o=>{o.isLocked||u.value&&D.push({name:"lesson",params:{courseId:v.value,lessonOrder:o.order}})};return P(b,async o=>{o&&(await be(),N.value?.focus())}),(o,c)=>(l(),r(m,null,[e("div",ze,[f(pe,{"nav-links":ee.value},null,8,["nav-links"]),e("main",Me,[e("button",{class:"inline-flex w-max items-center gap-2 rounded-full border border-strokePrimary/40 px-5 py-2 text-sm text-textSecondary transition hover:border-textPrimary hover:text-textPrimary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary","aria-label":a(t)("course.backToCourses"),tabindex:"0",onClick:$},[f(Se,{class:"h-4 w-4"}),g(" "+s(a(t)("course.backToCourses")),1)],8,We),n.value?(l(),r("section",Ne,[e("div",Ae,[e("p",$e,s(a(t)("course.label")),1),e("div",Re,[e("div",Ve,[e("div",Fe,[n.value.image_path?(l(),r("div",He,[e("img",{src:n.value.image_path,alt:n.value.title,class:"h-full w-full object-contain"},null,8,Je)])):H("",!0),e("h1",Ke,s(n.value.title),1)]),e("p",Oe,s(n.value.description),1),e("div",Ee,[(l(!0),r(m,null,J(n.value.tags||[],i=>(l(),r("span",{key:i,class:"rounded-full border border-textPrimary/30 bg-cardDarker px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-textPrimary"},s(i),1))),128))])]),e("div",qe,[e("div",Ge,[e("div",Ue,[c[1]||(c[1]=e("span",null,"PD",-1)),e("strong",Qe,s(n.value.reward),1)]),e("div",Xe,[c[2]||(c[2]=e("span",null,"Tasks",-1)),e("strong",Ye,s(n.value.tasks),1)]),e("div",Ze,[c[3]||(c[3]=e("span",null,"Time",-1)),e("strong",et,s(n.value.duration),1)])]),e("div",null,[e("div",tt,[e("span",null,s(a(t)("course.lessonsCompleted")),1),e("span",null,s(W.value)+"/"+s(x.value.length)+" • "+s(w.value)+"%",1)]),e("div",st,[e("div",{class:"h-full rounded-full bg-gradient-to-r from-textPrimary to-[#6dd5ed]",style:fe({width:`${w.value}%`})},null,4)])]),k.value?(l(),r("div",ct,s(a(t)("course.guestAccess")),1)):(l(),r("div",ot,[u.value?C.value?(l(),r(m,{key:1},[e("div",rt,s(a(t)("course.completed")),1),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-full border border-emerald-300/60 bg-transparent px-6 py-3 text-sm font-semibold text-emerald-200","aria-label":a(t)("course.completed"),tabindex:"0",disabled:""},[f(O,{class:"h-4 w-4"}),g(" "+s(a(t)("course.completed")),1)],8,lt)],64)):(l(),r(m,{key:2},[e("div",it,s(a(t)("course.alreadyJoined")),1),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-full border border-textPrimary/60 px-6 py-3 text-sm font-semibold text-textPrimary transition hover:bg-textPrimary/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary","aria-label":a(t)("course.leaveCourse"),tabindex:"0",onClick:le},[f(Ce,{class:"h-4 w-4"}),g(" "+s(a(t)("course.leaveCourse")),1)],8,nt)],64)):(l(),r("button",{key:0,class:"flex w-full items-center justify-center gap-2 rounded-full bg-textPrimary px-6 py-3 text-sm font-semibold text-bgPrimary transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary","aria-label":a(t)("course.joinCourse"),tabindex:"0",onClick:re},[f(Be,{class:"h-4 w-4"}),g(" "+s(a(t)("course.joinCourse")),1)],8,at))]))])])]),e("div",dt,[e("div",ut,[e("h2",xt,s(a(t)("course.lessons")),1)]),e("ul",ft,[(l(!0),r(m,null,J(x.value,(i,p)=>(l(),r("li",{key:i.id,class:K(["flex flex-col gap-4 rounded-2xl border border-strokePrimary/30 bg-dialogBg p-4 transition hover:border-textPrimary/50 focus-within:border-textPrimary/80",{"cursor-pointer hover:bg-cardHover":!i.isLocked&&u.value}]),onClick:V=>ne(i)},[e("div",vt,[e("div",bt,[e("p",pt,[e("span",ht,"Lekcja "+s(i.order??p)+":",1),g(" "+s(i.title),1)])]),e("div",gt,[e("span",{class:K(["rounded-full px-3 py-1 text-xs font-semibold",oe[R(i)]])},s(se.value[R(i)]),3),i.isLocked?(l(),r("span",{key:0,class:"flex h-9 w-9 items-center justify-center rounded-full border border-strokePrimary/40 text-textSecondary","aria-label":a(t)("course.lessonLocked"),tabindex:"0"},[f(De,{class:"h-4 w-4"})],8,yt)):(l(),r("span",{key:1,class:"flex h-9 w-9 items-center justify-center rounded-full border border-textPrimary/40 text-textPrimary","aria-label":a(t)("course.startLesson"),tabindex:"0"},[f(O,{class:"h-4 w-4"})],8,_t))])])],10,mt))),128))])])])):(l(),r("section",kt,[a(q)?(l(),r(m,{key:0},[e("h1",wt,s(a(t)("common.loading")),1),e("p",Ct,s(a(t)("common.loading")),1)],64)):(l(),r(m,{key:1},[e("h1",Pt,s(a(t)("common.error")),1),e("p",Lt,s(a(t)("common.error")),1),e("button",{class:"rounded-full border border-textPrimary px-6 py-3 text-sm font-semibold text-textPrimary transition hover:bg-textPrimary hover:text-bgPrimary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary","aria-label":a(t)("course.backToCourses"),tabindex:"0",onClick:$},s(a(t)("course.backToCourses")),9,Dt)],64))]))])]),b.value?(l(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 py-8",role:"dialog","aria-modal":"true","aria-labelledby":"leave-course-title","aria-describedby":"leave-course-description",tabindex:"0",onKeydown:me(L(_,["prevent"]),["esc"]),onClick:L(_,["self"])},[e("div",{class:"relative w-full max-w-md space-y-5 rounded-3xl border border-strokePrimary/40 bg-dialogBg p-6 shadow-2xl shadow-black/40",onClick:c[0]||(c[0]=L(()=>{},["stop"]))},[e("div",jt,[e("span",It,[f(Pe,{class:"h-5 w-5"})]),e("div",null,[e("h3",Tt,s(a(t)("leaveDialog.title")),1),e("p",Bt,s(a(t)("leaveDialog.description")),1)])]),e("div",zt,[e("button",{class:"flex flex-1 items-center justify-center gap-2 rounded-full border border-textSecondary/40 px-4 py-2.5 text-sm font-semibold text-textSecondary transition hover:bg-white/5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-textPrimary","aria-label":a(t)("leaveDialog.cancel"),tabindex:"0",onClick:_},s(a(t)("leaveDialog.cancel")),9,Mt),e("button",{ref_key:"leaveDialogConfirmRef",ref:N,class:"flex flex-1 items-center justify-center gap-2 rounded-full bg-[#ff4d6d] px-4 py-2.5 text-sm font-semibold text-white transition hover:bg-[#ff4d6d]/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[#0c1322]","aria-label":a(t)("leaveDialog.confirm"),tabindex:"0",onClick:ie},s(a(t)("leaveDialog.confirm")),9,Wt)])])],40,St)):H("",!0)],64))}});export{Kt as default};
