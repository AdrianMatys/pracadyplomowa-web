import{b as p,u as x}from"./main-CyjH2vMn.js";import{c as A}from"./MainHeader.vue_vue_type_script_setup_true_lang-BKi87J7A.js";import{r as v,B as k}from"./vendor-lIf_UB2E.js";const I=[{id:"home",label:"Strona główna",path:"/"},{id:"news",label:"Aktualności",path:"/aktualnosci"},{id:"profile",label:"Profil",path:"/profil"}],P=[{id:"levels",title:"filters.levels",options:[{id:"junior",label:"Junior"},{id:"mid",label:"Mid"},{id:"senior",label:"Senior"}]},{id:"tech",title:"filters.technologies",options:[{id:"javascript",label:"JavaScript"},{id:"php",label:"PHP"},{id:"react",label:"React"},{id:"vue",label:"Vue"},{id:"node.js",label:"Node.js"},{id:"laravel",label:"Laravel"}]}],w=e=>({id:String(e.id),title:e.title,subtitle:e.description,level:e.level||"Junior",reward:String(e.reward||0),tasks:String(e.lessons_count||e.lessons?.length||0),duration:e.duration?`${e.duration} min`:"30 min",accent:"blue",description:e.description,lessons:(e.lessons||[]).map(a=>{const t=a.exercises?.[0]||a.exercise;return{id:String(a.id),title:a.title,duration:"10 min",isCompleted:!1,isLocked:!1,order:a.order,content:a.content,taskContent:t?.description||a.content,initialCode:t?.initial_code||"",validationRegex:t?.validation_regex,judge0LanguageId:t?.judge0_language_id,expectedOutput:t?.expected_output,testCode:t?.test_code,editorLabel:t?.editor_label,exerciseId:t?.id?String(t.id):void 0,hint:t?.hint,hint2:t?.hint2,previewType:t?.preview_type||"none"}}),tags:e.tags?.map(a=>a.name||a)||[],enrolledCount:e.progress_count||e.enrolled_count||0,image_path:e.image_path?e.image_path.startsWith("/")||e.image_path.startsWith("http")?e.image_path:"/"+e.image_path:void 0}),E=async e=>{const[a,t]=await Promise.all([p.get("/api/courses",{headers:{"Accept-Language":e}}),p.get("/api/technologies",{headers:{"Accept-Language":e}})]),o=a.data,n=t.data,d=(Array.isArray(o)?o:o.data||[]).map(w),u=(Array.isArray(n)?n:[]).map(c=>({id:c.name?.toLowerCase()||String(c.id),label:c.name})),i=[P[0],{id:"tech",title:"filters.technologies",options:u}],l=d.reduce((c,h)=>c+parseInt(h.tasks||"0",10),0),g=d.reduce((c,h)=>c+parseInt(h.reward||"0",10),0);return{courses:d,filterSections:i,navLinks:I,stats:{coursesCount:d.length,tasksCount:l,totalPoints:g}}},$=async(e,a)=>{try{const t=await p.get(`/api/courses/${e}`,{headers:{"Accept-Language":a}});return w(t.data)}catch(t){return console.error("Error fetching course:",t),null}},W=async e=>{const[a,t,o]=await Promise.all([p.get("/api/users/me",{headers:{"Accept-Language":e}}),p.get("/api/courses",{headers:{"Accept-Language":e}}),p.get("/api/users/me/achievements",{headers:{"Accept-Language":e}})]),n=a.data,d=Array.isArray(t.data)?t.data:t.data.data||[],u=o.data,i=(n.progress||[]).map(s=>({courseId:String(s.course_id),completedLessonIds:(s.completed_lesson_ids||[]).map(String),savedCode:s.saved_code||{},status:s.status||"enrolled"})),l=[],g=[];for(const s of n.progress||[]){const r=s.course||d.find(f=>f.id===s.course_id);if(!r)continue;const m=r.lessons_count||(Array.isArray(r.lessons)?r.lessons.length:0),y=(s.completed_lesson_ids||[]).length,D=m>0?Math.round(y/m*100):0,C=Array.isArray(r.lessons)?r.lessons.find(f=>!(s.completed_lesson_ids||[]).includes(String(f.id)))?.title:void 0,b={id:String(r.id),title:r.title,level:r.level||"Junior",progress:D,completedLessons:y,totalLessons:m,accent:"blue",status:s.status==="completed"?"completed":"enrolled",updatedAt:s.updated_at||new Date().toISOString(),nextLesson:C,image_path:r.image_path?r.image_path.startsWith("/")||r.image_path.startsWith("http")?r.image_path:"/"+r.image_path:void 0};s.status==="completed"?l.push(b):g.push(b)}const c=n.profile?.experience_points||0,h={nickname:n.profile?.nickname||n.email||"User",description:n.profile?.bio||"",avatarUrl:A(n.profile?.avatar_url),progress:0,completed:l.length,inProgress:g.length,waitingTasks:n.profile?.streak||0,level:Math.floor(c/1e3)+1<=5?"Junior":Math.floor(c/1e3)+1<=15?"Mid":"Senior",xp:c},S=(u||[]).map(s=>({id:String(s.id),title:s.title||s.name,title_en:s.title_en,type:s.type||"achievement",level:s.level||"bronze",isEarned:!!s.isEarned,description:s.description||"",description_en:s.description_en}));return{summary:h,achievements:S,completedCourses:l,enrolledCourses:g,courseProgress:i}},B=async(e,a,t)=>{await p.post(`/api/courses/${e}/lessons/${a}/complete`,{user_code:t})},L=e=>{const a=e.user||e.author;return{id:String(e.id),title:e.title,excerpt:e.excerpt||e.content?.substring(0,150)+"...",content:e.content,date:e.created_at||e.date||e.updated_at,readTime:e.read_time||"5 min",author:a?.profile?.nickname||a?.email||e.author_name||"Admin",authorAvatar:A(a?.profile?.avatar_url),authorEmail:a?.email,category:e.category||e.type||"news",tags:e.tags?.map(t=>t.name||t)||[],accent:e.accent||"blue",is_published:e.is_published}},O=async()=>{const a=(await p.get("/api/news")).data,t=(a.data||a||[]).map(L);return{articles:t,featured:t[0]}},U=async e=>{try{const a=await p.get(`/api/news/${e}`);return L(a.data)}catch{return null}};function R(e,a){const t=v(null),o=v(!1),n=v(null);return{data:t,isLoading:o,error:n,load:async(i=!1)=>{if(!(!i&&t.value)&&!o.value){o.value=!0,n.value=null;try{t.value=await e()}catch(l){n.value=l instanceof Error?l.message:String(l)}finally{o.value=!1}}},refresh:async()=>{o.value=!0;try{t.value=await e(),n.value=null}catch(i){n.value=i instanceof Error?i.message:String(i)}finally{o.value=!1}}}}let _=null;function j(){const{currentLanguage:e}=x(),{data:a,isLoading:t,error:o,load:n,refresh:d}=R(()=>E(e.value)),u=(l=!1)=>n(l),i=()=>d();return k(e,()=>{a.value&&i()}),{dashboardData:a,isDashboardLoading:t,dashboardError:o,loadDashboardData:u,refreshDashboardData:i}}const N=()=>(_||(_=j()),_);export{R as a,W as b,B as c,O as d,U as e,$ as f,N as u};
