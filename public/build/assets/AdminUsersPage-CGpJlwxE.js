import{a as d,o as r,b as t,d as K,r as p,e as W,G as Q,m as x,g as L,s as R,t as i,i as s,v as Y,F as j,h as N,p as Z,n as w,q as ee}from"./vendor-lIf_UB2E.js";import{_ as te,a as ne,u as oe,b as _,c as se}from"./main-AnIw5FzX.js";import{_ as V}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-x_qbTs3G.js";import"./axios-B9ygI19o.js";const ae={},ie={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"};function le(A,l){return r(),d("svg",ie,[...l[0]||(l[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"},null,-1)])])}const de=te(ae,[["render",le]]),re={class:"space-y-6"},ce={class:"flex items-center justify-between"},ue={class:"text-3xl font-bold text-textWhite"},pe=["placeholder"],me={class:"rounded-xl border border-strokePrimary/30 bg-card overflow-hidden"},be={class:"overflow-x-auto"},ve={class:"w-full text-left border-collapse"},xe={class:"bg-bgSecondary text-textSecondary uppercase text-xs"},he={class:"px-4 py-4 font-semibold hidden sm:table-cell"},_e={class:"px-4 py-4 font-semibold"},fe={class:"px-4 py-4 font-semibold hidden md:table-cell"},ge={class:"px-4 py-4 font-semibold hidden xl:table-cell"},ye={class:"px-4 py-4 font-semibold text-right"},ke={class:"divide-y divide-strokePrimary/20 text-sm"},we={key:0},Ce={colspan:"8",class:"px-4 py-8 text-center text-textSecondary"},Se={key:1},Me={colspan:"8",class:"px-4 py-8 text-center text-textSecondary"},Pe={class:"px-4 py-4 text-textSecondary font-mono hidden sm:table-cell"},$e={class:"px-4 py-4 font-medium text-textWhite"},De={class:"flex flex-col"},Le={key:0,class:"ml-1 px-1.5 py-0.5 bg-primary/20 text-primary text-[10px] rounded uppercase font-bold"},Ue={class:"text-xs text-textSecondary lg:hidden"},Be={class:"px-4 py-4 text-textSecondary hidden lg:table-cell truncate max-w-[200px]"},ze={class:"px-4 py-4 hidden md:table-cell"},Ee=["value","onChange"],Xe={class:"px-4 py-4 hidden md:table-cell"},Te={class:"flex items-center gap-1"},We=["value","onInput"],je=["onClick"],Ne={class:"px-4 py-4 text-textSecondary hidden xl:table-cell whitespace-nowrap"},Ve={class:"px-4 py-4"},Ae={class:"px-4 py-4 text-right"},Ie={class:"hidden lg:flex items-center justify-end gap-2"},He=["disabled","onClick"],Oe=["onClick"],Fe=["disabled","onClick"],qe={class:"lg:hidden relative actions-dropdown"},Ge=["onClick"],Je={key:0,class:"absolute right-0 bottom-full mb-1 w-40 bg-bgPrimary border border-strokePrimary/30 rounded-lg shadow-xl z-20 py-1"},Ke=["disabled","onClick"],Qe=["onClick"],Re=["disabled","onClick"],Ye={key:0,class:"flex justify-center gap-2 mt-4"},Ze=["onClick"],st=K({__name:"AdminUsersPage",setup(A){const{notify:l}=se(),{user:b,refreshUser:U}=ne(),{t:o}=oe(),f=p(null),I=n=>{f.value=f.value===n?null:n},g=()=>{f.value=null},B=n=>{n.target.closest(".actions-dropdown")||g()};W(()=>{document.addEventListener("click",B)}),Q(()=>{document.removeEventListener("click",B)});const y=p([]),C=p(!0),S=p(""),M=p(1),P=p(1),m=p({}),v=p({}),$=p(!1),D=p(!1),h=p(null),c=p(null),k=async(n=1)=>{C.value=!0;try{const a=await _.get(`/api/admin/users?page=${n}&search=${S.value}`);a.data&&a.data.data?(y.value=a.data.data,M.value=a.data.current_page,P.value=a.data.last_page,m.value={}):y.value=[]}catch{l("error",o("admin.users.notifications.fetchError"))}finally{C.value=!1}},H=(n,a)=>{m.value[n]=a},z=async n=>{const a=m.value[n.id];if(a)try{const e=await _.patch(`/api/admin/users/${n.id}/level`,{level:a});n.level=e.data.user.level,delete m.value[n.id],l("success",o("admin.users.notifications.levelUpdated")),n.id===b.value?.id&&await U()}catch{l("error",o("admin.users.notifications.levelError"))}},E=n=>m.value[n.id]!==void 0&&m.value[n.id]!==n.level,O=(n,a)=>{v.value[n]=a},F=async n=>{const a=v.value[n.id];if(a!==void 0)try{const e=await _.patch(`/api/admin/users/${n.id}/xp`,{experience_points:a});n.profile&&(n.profile.experience_points=a),e.data.user&&e.data.user.level&&(n.level=e.data.user.level,m.value[n.id]===n.level&&delete m.value[n.id]),delete v.value[n.id],l("success","XP zaktualizowane"),n.id===b.value?.id&&await U()}catch{l("error","Błąd aktualizacji XP")}},q=n=>v.value[n.id]!==void 0&&v.value[n.id]!==(n.profile?.experience_points??0),X=n=>{if(n.id===b.value?.id){l("error",o("admin.users.notifications.banSelf"));return}c.value=n,D.value=!0},G=async()=>{if(c.value)try{const n=await _.patch(`/api/admin/users/${c.value.id}/ban`);c.value.is_banned=n.data.user.is_banned,l("success",c.value.is_banned?o("admin.users.notifications.bannedSuccess"):o("admin.users.notifications.unbannedSuccess"))}catch{l("error",o("admin.users.notifications.statusError"))}},T=n=>{if(n.id===b.value?.id){l("error",o("admin.users.notifications.deleteSelf"));return}h.value=n,$.value=!0},J=async()=>{if(h.value)try{await _.delete(`/api/admin/users/${h.value.id}`),l("success",o("admin.users.notifications.userDeleted")),k(M.value)}catch{l("error",o("admin.users.notifications.deleteError"))}};return W(()=>k()),(n,a)=>(r(),d("div",re,[t("div",ce,[t("h1",ue,i(s(o)("admin.users.title")),1),R(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),type:"text",placeholder:s(o)("admin.users.searchPlaceholder"),class:"bg-bgSecondary border border-strokePrimary/30 rounded-lg px-4 py-2 text-textWhite text-sm focus:border-primary focus:outline-none transition-colors w-64",onInput:a[1]||(a[1]=e=>k(1))},null,40,pe),[[Y,S.value]])]),t("div",me,[t("div",be,[t("table",ve,[t("thead",xe,[t("tr",null,[t("th",he,i(s(o)("admin.common.id")),1),t("th",_e,i(s(o)("admin.users.table.nickname")),1),a[4]||(a[4]=t("th",{class:"px-4 py-4 font-semibold hidden lg:table-cell"},"Email",-1)),t("th",fe,i(s(o)("admin.users.table.level")||"Level"),1),a[5]||(a[5]=t("th",{class:"px-4 py-4 font-semibold hidden md:table-cell"},"XP",-1)),t("th",ge,i(s(o)("admin.common.createdAt")),1),a[6]||(a[6]=t("th",{class:"px-4 py-4 font-semibold"},"Status",-1)),t("th",ye,i(s(o)("admin.common.actions")),1)])]),t("tbody",ke,[C.value?(r(),d("tr",we,[t("td",Ce,i(s(o)("admin.common.loading")),1)])):y.value.length===0?(r(),d("tr",Se,[t("td",Me,i(s(o)("admin.users.noUsers")),1)])):(r(!0),d(j,{key:2},N(y.value,e=>(r(),d("tr",{key:e.id,class:"hover:bg-cardHover transition-colors"},[t("td",Pe,i(e.id),1),t("td",$e,[t("div",De,[t("span",null,[Z(i(e.profile?.nickname||s(o)("admin.users.noNickname"))+" ",1),e.isAdmin?(r(),d("span",Le,"Admin")):x("",!0)]),t("span",Ue,i(e.email),1)])]),t("td",Be,i(e.email),1),t("td",ze,[t("select",{value:m.value[e.id]??e.level,class:"bg-bgSecondary border border-strokePrimary/30 rounded px-2 py-1 text-textWhite text-xs focus:border-primary focus:outline-none w-full max-w-[100px]",onChange:u=>H(e.id,u.target.value)},[...a[7]||(a[7]=[t("option",{value:"junior"},"Junior",-1),t("option",{value:"mid"},"Mid",-1),t("option",{value:"senior"},"Senior",-1)])],40,Ee)]),t("td",Xe,[t("div",Te,[t("input",{type:"number",value:v.value[e.id]??e.profile?.experience_points??0,class:"bg-bgSecondary border border-strokePrimary/30 rounded px-2 py-1 text-textWhite text-xs focus:border-primary focus:outline-none w-16",onInput:u=>O(e.id,parseInt(u.target.value)||0)},null,40,We),q(e)?(r(),d("button",{key:0,class:"px-2 py-1 rounded bg-green-500/10 text-green-500 hover:bg-green-500/20 transition-colors text-xs font-bold shrink-0",onClick:u=>F(e)},"✓",8,je)):x("",!0)])]),t("td",Ne,i(new Date(e.created_at).toLocaleDateString()),1),t("td",Ve,[t("span",{class:w(["px-2 py-1 rounded text-xs font-bold uppercase whitespace-nowrap",e.is_banned?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"])},i(e.is_banned?s(o)("admin.users.banned"):s(o)("admin.users.active")),3)]),t("td",Ae,[t("div",Ie,[t("button",{disabled:e.id===s(b)?.id,class:w(["px-3 py-1.5 rounded transition-colors text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",e.is_banned?"bg-green-500/10 text-green-500 hover:bg-green-500/20":"bg-amber-500/10 text-amber-500 hover:bg-amber-500/20"]),onClick:u=>X(e)},i(e.is_banned?s(o)("admin.users.unban"):s(o)("admin.users.ban")),11,He),E(e)?(r(),d("button",{key:0,class:"px-3 py-1.5 rounded bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 transition-colors text-xs font-bold whitespace-nowrap",onClick:u=>z(e)},i(s(o)("admin.common.save")),9,Oe)):x("",!0),t("button",{disabled:e.id===s(b)?.id,class:"px-3 py-1.5 rounded bg-red-500/10 text-red-500 hover:bg-red-500/20 transition-colors text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",onClick:u=>T(e)},i(s(o)("admin.common.delete")),9,Fe)]),t("div",qe,[t("button",{class:"p-2 rounded bg-bgSecondary text-textSecondary hover:text-textWhite hover:bg-cardHover transition-colors",onClick:ee(u=>I(e.id),["stop"])},[L(de,{class:"h-5 w-5"})],8,Ge),f.value===e.id?(r(),d("div",Je,[t("button",{disabled:e.id===s(b)?.id,class:w(["w-full text-left px-4 py-2 text-xs font-bold transition-colors disabled:opacity-50",e.is_banned?"text-green-500 hover:bg-green-500/10":"text-amber-500 hover:bg-amber-500/10"]),onClick:u=>{X(e),g()}},i(e.is_banned?s(o)("admin.users.unban"):s(o)("admin.users.ban")),11,Ke),E(e)?(r(),d("button",{key:0,class:"w-full text-left px-4 py-2 text-xs font-bold text-blue-500 hover:bg-blue-500/10 transition-colors",onClick:u=>{z(e),g()}},i(s(o)("admin.common.save")),9,Qe)):x("",!0),t("button",{disabled:e.id===s(b)?.id,class:"w-full text-left px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-500/10 transition-colors disabled:opacity-50",onClick:u=>{T(e),g()}},i(s(o)("admin.common.delete")),9,Re)])):x("",!0)])])]))),128))])])])]),P.value>1?(r(),d("div",Ye,[(r(!0),d(j,null,N(P.value,e=>(r(),d("button",{key:e,class:w(["w-8 h-8 rounded-lg text-xs font-bold transition-colors",M.value===e?"bg-primary text-textWhite":"bg-bgSecondary text-textSecondary hover:bg-cardHover"]),onClick:u=>k(e)},i(e),11,Ze))),128))])):x("",!0),L(V,{"is-open":$.value,"onUpdate:isOpen":a[2]||(a[2]=e=>$.value=e),title:s(o)("admin.users.deleteModalTitle"),message:s(o)("admin.users.deleteModalMessage",{name:h.value?.profile?.nickname||h.value?.email||""}),"confirm-text":s(o)("admin.common.delete"),"cancel-text":s(o)("admin.common.cancel"),"is-danger":"",onConfirm:J},null,8,["is-open","title","message","confirm-text","cancel-text"]),L(V,{"is-open":D.value,"onUpdate:isOpen":a[3]||(a[3]=e=>D.value=e),title:c.value?.is_banned?s(o)("admin.users.unbanModalTitle"):s(o)("admin.users.banModalTitle"),message:c.value?.is_banned?s(o)("admin.users.unbanModalMessage",{name:c.value?.profile?.nickname||c.value?.email||""}):s(o)("admin.users.banModalMessage",{name:c.value?.profile?.nickname||c.value?.email||""}),"confirm-text":c.value?.is_banned?s(o)("admin.users.unban"):s(o)("admin.users.ban"),"cancel-text":s(o)("admin.common.cancel"),"is-danger":!c.value?.is_banned,onConfirm:G},null,8,["is-open","title","message","confirm-text","cancel-text","is-danger"])]))}});export{st as default};
